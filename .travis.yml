sudo: required

services:
  - docker

before_install:
  - sudo curl -k -O -sL https://deb.nodesource.com/setup_8.x
  - sudo bash setup_8.x
  - sudo apt install qemu-user-static kpartx aria2 nodejs
  - openssl aes-256-cbc -K $encrypted_cf15bf3bd0b6_key -iv $encrypted_cf15bf3bd0b6_iv
        -in deploy/id_deploy.enc -out deploy/id_deploy -d

install: true

script: mkdir images && ./get_ssh_keys.py && sudo ./treehouse-builder --noninteractive

deploy:
  provider: script
  skip_cleanup: true
  script: ./deploy/deploy.sh
  on:
    all_branches: true
    tags: true

notifications:
  webhooks:
    urls:
      - https://webhooks.gitter.im/e/2fd0c9991bb0b1f5dda1
    on_success: always # one of: always, never, change
    on_failure: always
    on_start: always
